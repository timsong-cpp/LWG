<?xml version='1.0' encoding='utf-8' standalone='no'?>
<!DOCTYPE issue SYSTEM "lwg-issue.dtd">

<issue num="3426" status="New">
<title><tt>operator&lt;=&gt;(const unique_ptr&lt;T, D&gt;&amp;, nullptr_t)</tt> can't get no satisfaction</title>
<section><sref ref="[unique.ptr.special]"/></section>
<submitter>Jonathan Wakely</submitter>
<date>09 Apr 2020</date>
<priority>99</priority>

<discussion>
<p>
The constraint for
<tt>operator&lt;=&gt;(const unique_ptr&lt;T, D&gt;&amp;, nullptr_t)</tt>
cannot be satisfied,
because <tt>std::three_way_comparable&lt;nullptr_t&gt;</tt> is <tt>false</tt>,
because <tt>nullptr &lt;=&gt; nullptr</tt> is ill-formed.
</p>

<p>
We can make it work as intended by comparing
<tt>x.get()</tt> to <tt>pointer(nullptr)</tt>
instead of to <tt>nullptr</tt> directly.
</p>

</discussion>

<resolution>
<p>
This wording is relative to <a href="http://wiki.edg.com/pub/Wg21summer2020/Documents/post-prague-wd.pdf">the 
post-Prague working draft preview</a>.
</p>

<ol>
<li><p>Modify <sref ref="[memory.syn]"/> as indicated:</p>

<blockquote>
<pre>
template&lt;class T, class D&gt;
  bool operator>=(nullptr_t, const unique_ptr&lt;T, D&gt;&amp; y);
template&lt;class T, class D&gt;
  requires three_way_comparable<DEL>_with</DEL>&lt;typename unique_ptr&lt;T, D>::pointer<DEL>, nullptr_t</DEL>&gt;
  compare_three_way_result_t&lt;typename unique_ptr&lt;T, D&gt;::pointer<DEL>, nullptr_t</DEL>&gt;
    operator&lt;=&gt;(const unique_ptr&lt;T, D&gt;&amp; x, nullptr_t);
</pre>
</blockquote>
</li>

<li><p>Modify <sref ref="[unique.ptr.special]"/> p18 as indicated:</p>

<blockquote>
<pre>
template&lt;class T, class D&gt;
  requires three_way_comparable<DEL>_with</DEL>&lt;typename unique_ptr&lt;T, D>::pointer<DEL>, nullptr_t</DEL>&gt;
  compare_three_way_result_t&lt;typename unique_ptr&lt;T, D&gt;::pointer<DEL>, nullptr_t</DEL>&gt;
    operator&lt;=&gt;(const unique_ptr&lt;T, D&gt;&amp; x, nullptr_t);
</pre>

<blockquote>
<p>
-18- <i>Returns:</i> <tt>compare_three_way()(x.get(), <INS>typename unique_ptr&lt;T, D&gt;::pointer(</INS>nullptr<INS>)</INS>)</tt>.
</p>
</blockquote>
</blockquote>
</li>
</ol>
</resolution>
</issue>
